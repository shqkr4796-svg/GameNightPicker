{% extends "base.html" %}

{% block title %}ëª¨í—˜ ì „íˆ¬ - ë¼ì´í”„ ì‹œë®¬ë ˆì´ì…˜{% endblock %}

{% block content %}
<div class="container-fluid" style="background-color: #1a1a1a; min-height: 100vh; padding: 15px; color: white;">
    <div class="row">
        <div class="col-lg-10 mx-auto">
            <!-- ìŠ¤í…Œì´ì§€ ì •ë³´ (ê°„ì†Œí™”) -->
            <div style="text-align: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #333;">
                <h5 style="font-weight: 700; letter-spacing: 2px; margin-bottom: 3px;">{{ battle_state.stage_name }}</h5>
                <p style="color: #999; font-size: 0.8rem; margin: 0;">{{ battle_state.difficulty }}</p>
            </div>

            <!-- ì  ëª¬ìŠ¤í„° (ìœ„) -->
            <div class="row mb-3">
                <div class="col-lg-8 mx-auto">
                    <div style="text-align: center;">
                        <div style="font-size: 0.75rem; color: #999; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">ìƒëŒ€</div>
                        <div style="background-color: #2a2a2a; border-radius: 6px; padding: 15px; border: 2px solid #444; display: flex; gap: 15px;">
                            <!-- ì  ëª¬ìŠ¤í„° ì´ë¯¸ì§€ -->
                            <div style="width: 120px; height: 120px; background: linear-gradient(135deg, #333 0%, #1a1a1a 100%); border-radius: 6px; display: flex; align-items: center; justify-content: center; overflow: hidden; flex-shrink: 0;">
                                {% if battle_state.enemy_monster.image %}
                                    <img src="{{ battle_state.enemy_monster.image }}" alt="{{ battle_state.enemy_monster.name }}" style="width: 100%; height: 100%; object-fit: cover;">
                                {% else %}
                                    <div style="font-size: 2rem;">
                                        {% set rarity_emoji = {'ë ˆì–´': 'ğŸ”´', 'ì—í”½': 'ğŸŸ ', 'ìœ ë‹ˆí¬': 'ğŸŸ£', 'ë ˆì „ë“œë¦¬': 'ğŸ’œ', 'ì‹ í™”ê¸‰': 'â­'} %}
                                        {{ rarity_emoji.get(battle_state.enemy_monster.rarity, '') }}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <!-- ì  ëª¬ìŠ¤í„° ì •ë³´ -->
                            <div style="flex: 1; text-align: left;">
                                <h6 style="font-weight: 700; margin-bottom: 6px; font-size: 1rem;">{{ battle_state.enemy_monster.name }}</h6>
                                <p style="color: #999; font-size: 0.75rem; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;">{{ battle_state.enemy_monster.rarity }}</p>
                                
                                <!-- HP ë°” -->
                                <div style="margin-bottom: 8px;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                        <span style="color: #999; font-size: 0.7rem; text-transform: uppercase;">HP</span>
                                        <span style="color: white; font-weight: 700; font-size: 0.75rem;">{{ battle_state.enemy_monster.current_hp }} / {{ battle_state.enemy_monster.max_hp }}</span>
                                    </div>
                                    <div style="width: 100%; height: 6px; background-color: #333; border-radius: 3px; overflow: hidden; border: 1px solid #444;">
                                        <div id="enemyHpBar" style="height: 100%; width: {{ (battle_state.enemy_monster.current_hp / battle_state.enemy_monster.max_hp * 100) }}%; background: linear-gradient(90deg, #FF6B6B, #ee5a52); transition: width 0.3s;"></div>
                                    </div>
                                </div>
                                
                                <!-- ê³µê²©ë ¥ -->
                                <div style="background-color: #333; padding: 6px 10px; border-radius: 4px; border: 1px solid #444;">
                                    <span style="color: #999; font-size: 0.7rem; text-transform: uppercase;">ATK</span>
                                    <span style="color: #FF6B6B; font-weight: 700; margin-left: 8px; font-size: 0.8rem;">{{ battle_state.enemy_monster.attack }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ì „íˆ¬ ë¡œê·¸ (ì¤„ì„) -->
            <div style="background-color: #2a2a2a; border-radius: 6px; padding: 10px; margin-bottom: 15px; border: 1px solid #444; max-height: 90px; overflow-y: auto;">
                <div style="font-size: 0.7rem; color: #999; line-height: 1.4;">
                    {% for log_line in battle_state.log[-10:] %}
                        <div style="margin-bottom: 2px; color: {% if 'í”Œë ˆì´ì–´' in log_line %}#4CAF50{% elif 'ì ' in log_line %}#FF6B6B{% else %}#bbb{% endif %};">
                            > {{ log_line }}
                        </div>
                    {% endfor %}
                </div>
            </div>

            <!-- ëŒ€ì‚¬ (ê°„ì†Œí™”) -->
            <div style="text-align: center; margin-bottom: 15px; padding: 12px; background-color: #2a2a2a; border-radius: 6px; border-left: 4px solid #666;">
                <p style="color: #bbb; font-style: italic; font-size: 0.8rem; margin: 0;">
                    {% if battle_state.player_turn %}
                        "{{ battle_state.player_dialogue }}"
                    {% else %}
                        "{{ battle_state.enemy_dialogue }}"
                    {% endif %}
                </p>
            </div>

            <!-- í”Œë ˆì´ì–´ ëª¬ìŠ¤í„° (ì•„ë˜) -->
            <div class="row mb-3">
                <div class="col-lg-8 mx-auto">
                    <div style="text-align: center;">
                        <div style="font-size: 0.75rem; color: #999; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">í”Œë ˆì´ì–´</div>
                        <div style="background-color: #2a2a2a; border-radius: 6px; padding: 15px; border: 2px solid #444; display: flex; gap: 15px;">
                            <!-- í”Œë ˆì´ì–´ ëª¬ìŠ¤í„° ì´ë¯¸ì§€ -->
                            <div style="width: 120px; height: 120px; background: linear-gradient(135deg, #333 0%, #1a1a1a 100%); border-radius: 6px; display: flex; align-items: center; justify-content: center; overflow: hidden; flex-shrink: 0;">
                                {% if battle_state.player_monster.image %}
                                    <img src="{{ battle_state.player_monster.image }}" alt="{{ battle_state.player_monster.name }}" style="width: 100%; height: 100%; object-fit: cover;">
                                {% else %}
                                    <div style="font-size: 2rem;">
                                        {{ rarity_emoji.get(battle_state.player_monster.rarity, '') }}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <!-- í”Œë ˆì´ì–´ ëª¬ìŠ¤í„° ì •ë³´ -->
                            <div style="flex: 1; text-align: left;">
                                <h6 style="font-weight: 700; margin-bottom: 6px; font-size: 1rem;">{{ battle_state.player_monster.name }}</h6>
                                <p style="color: #999; font-size: 0.75rem; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;">{{ battle_state.player_monster.rarity }}</p>
                                
                                <!-- HP ë°” -->
                                <div style="margin-bottom: 8px;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                        <span style="color: #999; font-size: 0.7rem; text-transform: uppercase;">HP</span>
                                        <span style="color: white; font-weight: 700; font-size: 0.75rem;">{{ battle_state.player_monster.current_hp }} / {{ battle_state.player_monster.max_hp }}</span>
                                    </div>
                                    <div style="width: 100%; height: 6px; background-color: #333; border-radius: 3px; overflow: hidden; border: 1px solid #444;">
                                        <div id="playerHpBar" style="height: 100%; width: {{ (battle_state.player_monster.current_hp / battle_state.player_monster.max_hp * 100) }}%; background: linear-gradient(90deg, #4CAF50, #45a049); transition: width 0.3s;"></div>
                                    </div>
                                </div>
                                
                                <!-- ê³µê²©ë ¥ -->
                                <div style="background-color: #333; padding: 6px 10px; border-radius: 4px; border: 1px solid #444;">
                                    <span style="color: #999; font-size: 0.7rem; text-transform: uppercase;">ATK</span>
                                    <span style="color: #4CAF50; font-weight: 700; margin-left: 8px; font-size: 0.8rem;">{{ battle_state.player_monster.attack }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ê¸°ìˆ  ì„ íƒ (ê²Œì„ ì§„í–‰ ì¤‘) -->
            {% if not battle_state.game_over %}
                <div id="actionContainer">
                    {% if battle_state.player_turn %}
                        <div style="text-align: center; margin-bottom: 15px;">
                            <p style="color: #999; font-size: 0.85rem; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 1px;">ê¸°ìˆ ì„ ì„ íƒí•˜ì„¸ìš”</p>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; max-width: 400px; margin: 0 auto;">
                                <!-- ìŠ¬ë¡¯ 1 -->
                                <div>
                                    {% if battle_state.player_skills|length > 0 %}
                                        {% set skill_name = battle_state.player_skills[0] %}
                                        {% set usage = skill_usage.get(skill_name, 0) %}
                                        <div style="position: relative;">
                                            <button onclick="showSkillInfo('{{ skill_name }}')" title="ê¸°ìˆ  ì •ë³´ ë³´ê¸°" class="btn w-100" id="skill-btn-0" style="background-color: {% if usage >= 4 %}#555{% else %}#333{% endif %}; color: {% if usage >= 4 %}#888{% else %}white{% endif %}; border: 2px solid {% if usage >= 4 %}#777{% else %}#555{% endif %}; border-radius: 6px; padding: 12px; font-size: 0.75rem; font-weight: 600; cursor: {% if usage >= 4 %}not-allowed{% else %}pointer{% endif %}; transition: all 0.3s; text-transform: uppercase; letter-spacing: 0.5px; word-break: break-word;" onmouseover="{% if usage < 4 %}this.style.backgroundColor='#444'; this.style.borderColor='#666';{% endif %}" onmouseout="{% if usage < 4 %}this.style.backgroundColor='#333'; this.style.borderColor='#555';{% endif %}" ondblclick="{% if usage < 4 %}useSkill('{{ skill_name }}'){% endif %}" {% if usage >= 4 %}disabled{% endif %}>
                                                {{ skill_name }}<br><span style="font-size: 0.6rem;">{{ usage }}/4</span>
                                            </button>
                                        </div>
                                    {% else %}
                                        <div style="height: 56px; background-color: transparent; border: 2px dashed #555; border-radius: 6px;"></div>
                                    {% endif %}
                                </div>
                                <!-- ìŠ¬ë¡¯ 2 -->
                                <div>
                                    {% if battle_state.player_skills|length > 1 %}
                                        {% set skill_name = battle_state.player_skills[1] %}
                                        {% set usage = skill_usage.get(skill_name, 0) %}
                                        <div style="position: relative;">
                                            <button onclick="showSkillInfo('{{ skill_name }}')" title="ê¸°ìˆ  ì •ë³´ ë³´ê¸°" class="btn w-100" id="skill-btn-1" style="background-color: {% if usage >= 4 %}#555{% else %}#333{% endif %}; color: {% if usage >= 4 %}#888{% else %}white{% endif %}; border: 2px solid {% if usage >= 4 %}#777{% else %}#555{% endif %}; border-radius: 6px; padding: 12px; font-size: 0.75rem; font-weight: 600; cursor: {% if usage >= 4 %}not-allowed{% else %}pointer{% endif %}; transition: all 0.3s; text-transform: uppercase; letter-spacing: 0.5px; word-break: break-word;" onmouseover="{% if usage < 4 %}this.style.backgroundColor='#444'; this.style.borderColor='#666';{% endif %}" onmouseout="{% if usage < 4 %}this.style.backgroundColor='#333'; this.style.borderColor='#555';{% endif %}" ondblclick="{% if usage < 4 %}useSkill('{{ skill_name }}'){% endif %}" {% if usage >= 4 %}disabled{% endif %}>
                                                {{ skill_name }}<br><span style="font-size: 0.6rem;">{{ usage }}/4</span>
                                            </button>
                                        </div>
                                    {% else %}
                                        <div style="height: 56px; background-color: transparent; border: 2px dashed #555; border-radius: 6px;"></div>
                                    {% endif %}
                                </div>
                                <!-- ìŠ¬ë¡¯ 3 -->
                                <div>
                                    {% if battle_state.player_skills|length > 2 %}
                                        {% set skill_name = battle_state.player_skills[2] %}
                                        {% set usage = skill_usage.get(skill_name, 0) %}
                                        <div style="position: relative;">
                                            <button onclick="showSkillInfo('{{ skill_name }}')" title="ê¸°ìˆ  ì •ë³´ ë³´ê¸°" class="btn w-100" id="skill-btn-2" style="background-color: {% if usage >= 4 %}#555{% else %}#333{% endif %}; color: {% if usage >= 4 %}#888{% else %}white{% endif %}; border: 2px solid {% if usage >= 4 %}#777{% else %}#555{% endif %}; border-radius: 6px; padding: 12px; font-size: 0.75rem; font-weight: 600; cursor: {% if usage >= 4 %}not-allowed{% else %}pointer{% endif %}; transition: all 0.3s; text-transform: uppercase; letter-spacing: 0.5px; word-break: break-word;" onmouseover="{% if usage < 4 %}this.style.backgroundColor='#444'; this.style.borderColor='#666';{% endif %}" onmouseout="{% if usage < 4 %}this.style.backgroundColor='#333'; this.style.borderColor='#555';{% endif %}" ondblclick="{% if usage < 4 %}useSkill('{{ skill_name }}'){% endif %}" {% if usage >= 4 %}disabled{% endif %}>
                                                {{ skill_name }}<br><span style="font-size: 0.6rem;">{{ usage }}/4</span>
                                            </button>
                                        </div>
                                    {% else %}
                                        <div style="height: 56px; background-color: transparent; border: 2px dashed #555; border-radius: 6px;"></div>
                                    {% endif %}
                                </div>
                                <!-- ìŠ¬ë¡¯ 4 -->
                                <div>
                                    {% if battle_state.player_skills|length > 3 %}
                                        {% set skill_name = battle_state.player_skills[3] %}
                                        {% set usage = skill_usage.get(skill_name, 0) %}
                                        <div style="position: relative;">
                                            <button onclick="showSkillInfo('{{ skill_name }}')" title="ê¸°ìˆ  ì •ë³´ ë³´ê¸°" class="btn w-100" id="skill-btn-3" style="background-color: {% if usage >= 4 %}#555{% else %}#333{% endif %}; color: {% if usage >= 4 %}#888{% else %}white{% endif %}; border: 2px solid {% if usage >= 4 %}#777{% else %}#555{% endif %}; border-radius: 6px; padding: 12px; font-size: 0.75rem; font-weight: 600; cursor: {% if usage >= 4 %}not-allowed{% else %}pointer{% endif %}; transition: all 0.3s; text-transform: uppercase; letter-spacing: 0.5px; word-break: break-word;" onmouseover="{% if usage < 4 %}this.style.backgroundColor='#444'; this.style.borderColor='#666';{% endif %}" onmouseout="{% if usage < 4 %}this.style.backgroundColor='#333'; this.style.borderColor='#555';{% endif %}" ondblclick="{% if usage < 4 %}useSkill('{{ skill_name }}'){% endif %}" {% if usage >= 4 %}disabled{% endif %}>
                                                {{ skill_name }}<br><span style="font-size: 0.6rem;">{{ usage }}/4</span>
                                            </button>
                                        </div>
                                    {% else %}
                                        <div style="height: 56px; background-color: transparent; border: 2px dashed #555; border-radius: 6px;"></div>
                                    {% endif %}
                                </div>
                            </div>
                            <p style="color: #999; font-size: 0.7rem; margin-top: 8px;">í´ë¦­ìœ¼ë¡œ ì •ë³´ ë³´ê¸°, ë”ë¸”í´ë¦­ìœ¼ë¡œ ì‚¬ìš©</p>
                        </div>
                    {% else %}
                        <div style="text-align: center; padding: 15px; background-color: #2a2a2a; border-radius: 6px; color: #999; border: 1px solid #444;">
                            <p style="font-size: 0.85rem; margin: 0; text-transform: uppercase; letter-spacing: 0.5px;">ì ì˜ í„´ì…ë‹ˆë‹¤...</p>
                        </div>
                    {% endif %}
                </div>
            {% else %}
                <!-- ì „íˆ¬ ì¢…ë£Œ -->
                <div style="text-align: center;">
                    {% if battle_state.winner == 'player' %}
                        <div style="background-color: #1a3a1a; border: 2px solid #4CAF50; border-radius: 8px; padding: 20px;">
                            <h4 style="color: #4CAF50; font-weight: 700; margin-bottom: 12px; font-size: 1.3rem; text-transform: uppercase; letter-spacing: 2px;">ìŠ¹ë¦¬!</h4>
                            <p style="color: #bbb; margin-bottom: 15px; font-size: 0.9rem;">ìŠ¤í…Œì´ì§€ {{ battle_state.stage_id }}ì„(ë¥¼) í´ë¦¬ì–´í–ˆìŠµë‹ˆë‹¤!</p>
                            <a href="{{ url_for('adventure') }}" class="btn" style="background-color: #4CAF50; color: white; border: none; border-radius: 6px; padding: 10px 20px; font-weight: 600; text-decoration: none; display: inline-block; cursor: pointer; transition: background-color 0.3s; font-size: 0.85rem;" onmouseover="this.style.backgroundColor='#45a049'" onmouseout="this.style.backgroundColor='#4CAF50'">
                                ê³„ì†í•˜ê¸°
                            </a>
                        </div>
                    {% else %}
                        <div style="background-color: #3a1a1a; border: 2px solid #FF6B6B; border-radius: 8px; padding: 20px;">
                            <h4 style="color: #FF6B6B; font-weight: 700; margin-bottom: 12px; font-size: 1.3rem; text-transform: uppercase; letter-spacing: 2px;">íŒ¨ë°°</h4>
                            <p style="color: #bbb; margin-bottom: 15px; font-size: 0.9rem;">ìŠ¤í…Œì´ì§€ {{ battle_state.stage_id }}ì—ì„œ íŒ¨ë°°í–ˆìŠµë‹ˆë‹¤.</p>
                            <a href="{{ url_for('adventure') }}" class="btn" style="background-color: #FF6B6B; color: white; border: none; border-radius: 6px; padding: 10px 20px; font-weight: 600; text-decoration: none; display: inline-block; cursor: pointer; transition: background-color 0.3s; font-size: 0.85rem;" onmouseover="this.style.backgroundColor='#ee5a52'" onmouseout="this.style.backgroundColor='#FF6B6B'">
                                ë‹¤ì‹œ ì‹œë„
                            </a>
                        </div>
                    {% endif %}
                </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- ê¸°ìˆ  ì •ë³´ ëª¨ë‹¬ -->
<div id="skillModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); z-index: 1000; padding: 20px;">
    <div style="background-color: #2a2a2a; border-radius: 8px; padding: 20px; max-width: 400px; margin: auto; margin-top: 50px; border: 2px solid #555; color: white;">
        <h5 id="modalSkillName" style="color: #bbb; font-weight: 700; margin-bottom: 15px; font-size: 1.1rem; text-transform: uppercase;"></h5>
        
        <div style="background-color: #333; padding: 12px; border-radius: 6px; margin-bottom: 12px;">
            <p id="modalSkillDesc" style="font-size: 0.85rem; color: #ccc; margin: 0; line-height: 1.5;"></p>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
            <div style="background-color: #333; padding: 10px; border-radius: 6px; text-align: center;">
                <p style="color: #999; font-size: 0.7rem; margin-bottom: 5px;">ë“±ê¸‰</p>
                <p id="modalSkillRarity" style="color: #bbb; font-weight: 700; margin: 0;"></p>
            </div>
            <div style="background-color: #333; padding: 10px; border-radius: 6px; text-align: center;">
                <p style="color: #999; font-size: 0.7rem; margin-bottom: 5px;">ë°ë¯¸ì§€</p>
                <p id="modalSkillDamage" style="color: #bbb; font-weight: 700; margin: 0;"></p>
            </div>
        </div>
        
        <div id="skillUseContainer" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <button onclick="closeSkillModal(); useSkill(currentSkill)" class="btn w-100" style="background-color: #4CAF50; color: white; border: none; border-radius: 6px; padding: 10px; font-weight: 600; cursor: pointer; font-size: 0.85rem;" onmouseover="this.style.backgroundColor='#45a049'" onmouseout="this.style.backgroundColor='#4CAF50'">
                ì‚¬ìš©
            </button>
            <button onclick="closeSkillModal(); deleteSkill(currentSkill)" id="deleteSkillBtn" class="btn w-100" style="background-color: #FF6B6B; color: white; border: none; border-radius: 6px; padding: 10px; font-weight: 600; cursor: pointer; font-size: 0.85rem;" onmouseover="this.style.backgroundColor='#ee5a52'" onmouseout="this.style.backgroundColor='#FF6B6B'">
                ì‚­ì œ
            </button>
        </div>
        
        <button onclick="closeSkillModal()" class="btn w-100" style="background-color: #333; color: #999; border: 1px solid #555; border-radius: 6px; padding: 10px; font-weight: 600; cursor: pointer; font-size: 0.85rem; margin-top: 10px;">
            ë‹«ê¸°
        </button>
    </div>
</div>

<script>
let currentSkill = '';
const skillsInfo = {{ skills_info | tojson }};
const playerSkills = {{ battle_state.player_skills | tojson }};
const skillUsage = {{ skill_usage | tojson }};

function showSkillInfo(skillName) {
    currentSkill = skillName;
    const skill = skillsInfo[skillName];
    
    if (skill) {
        document.getElementById('modalSkillName').textContent = skill['í•œê¸€'] || skillName;
        document.getElementById('modalSkillDesc').textContent = skill['ì„¤ëª…'] + '\n' + skill['íš¨ê³¼'];
        document.getElementById('modalSkillRarity').textContent = skill['ë“±ê¸‰'];
        
        // ë²”ìœ„ í‘œì‹œ
        const minDmg = (skill['ê³µê²©ë ¥_ë³´ì •_min'] * 100).toFixed(0);
        const maxDmg = (skill['ê³µê²©ë ¥_ë³´ì •_max'] * 100).toFixed(0);
        const usageCount = skillUsage[skillName] || 0;
        document.getElementById('modalSkillDamage').textContent = minDmg + '%~' + maxDmg + '% (' + usageCount + '/4)';
        
        // 4ê°œ ì´ˆê³¼ì‹œë§Œ ì‚­ì œ ë²„íŠ¼ í‘œì‹œ
        const deleteBtn = document.getElementById('deleteSkillBtn');
        if (playerSkills.length > 4) {
            deleteBtn.style.display = 'block';
        } else {
            deleteBtn.style.display = 'none';
        }
        
        document.getElementById('skillModal').style.display = 'block';
    }
}

function closeSkillModal() {
    document.getElementById('skillModal').style.display = 'none';
}

function deleteSkill(skillName) {
    if (playerSkills.length <= 4) {
        alert('4ê°œ ì´í•˜ì˜ ê¸°ìˆ ë§Œ ë³´ìœ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
        return;
    }
    
    const form = new FormData();
    form.append('skill_name', skillName);
    
    fetch("{{ url_for('delete_skill') }}", {
        method: 'POST',
        body: form
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(data.message);
            location.reload();
        } else {
            alert('ì˜¤ë¥˜: ' + data.error);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    });
}

function useSkill(skillName) {
    const form = new FormData();
    form.append('action_type', 'skill');
    form.append('skill_name', skillName);
    
    fetch("{{ url_for('adventure_action') }}", {
        method: 'POST',
        body: form
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            const battle = data.battle_state;
            
            // HP ë°” ì—…ë°ì´íŠ¸
            const playerHpPercent = (battle.player_monster.current_hp / battle.player_monster.max_hp * 100);
            const enemyHpPercent = (battle.enemy_monster.current_hp / battle.enemy_monster.max_hp * 100);
            
            document.getElementById('playerHpBar').style.width = playerHpPercent + '%';
            document.getElementById('enemyHpBar').style.width = enemyHpPercent + '%';
            
            // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
            setTimeout(() => location.reload(), 1000);
        } else {
            alert('ì˜¤ë¥˜: ' + data.error);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    });
}

// ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
document.getElementById('skillModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeSkillModal();
    }
});
</script>
{% endblock %}
