{% extends "base.html" %}

{% block title %}ì¼ì¼ í‘œí˜„ - ë¼ì´í”„ ì‹œë®¬ë ˆì´ì…˜{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8 offset-lg-2">
        <!-- ì¼ì¼ í‘œí˜„ í—¤ë” -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">
                    <i class="fas fa-sparkles me-2"></i>ì˜¤ëŠ˜ì˜ í‘œí˜„ í•™ìŠµ
                </h4>
            </div>
            <div class="card-body">
                <div class="row text-center mb-4">
                    <div class="col-md-4">
                        <h6 class="text-muted mb-2">ì§„í–‰ ìƒí™©</h6>
                        <div class="progress" style="height: 25px;">
                            <div class="progress-bar bg-success" role="progressbar" 
                                 style="width: {{ (progress / 5 * 100) }}%;" 
                                 aria-valuenow="{{ progress }}" aria-valuemin="0" aria-valuemax="5">
                                {{ progress }}/5
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <h6 class="text-muted mb-2">ë³´ìƒ</h6>
                        <p class="mb-0">
                            {% if completed %}
                                <span class="badge bg-success">ì™„ë£Œ!</span>
                            {% else %}
                                <span class="badge bg-warning">ì™„ë£Œ ì‹œ ê²½í—˜ì¹˜ +50</span>
                            {% endif %}
                        </p>
                    </div>
                    <div class="col-md-4">
                        <h6 class="text-muted mb-2">ìƒíƒœ</h6>
                        <p class="mb-0">
                            {% if completed %}
                                <span class="badge bg-info">ì˜¤ëŠ˜ ì™„ë£Œë¨</span>
                            {% else %}
                                <span class="badge bg-secondary">ì§„í–‰ ì¤‘</span>
                            {% endif %}
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- í‘œí˜„ ì¹´ë“œ -->
        {% if expressions and current_index >= 0 %}
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">í‘œí˜„ #{{ current_index + 1 }}: {{ expressions[current_index].expression }}</h5>
            </div>
            <div class="card-body">
                <div class="row mb-4">
                    <div class="col-md-12">
                        <h6 class="text-muted mb-3">1ï¸âƒ£ ì˜ˆë¬¸ ë“£ê¸°</h6>
                        <div class="alert alert-info mb-3">
                            <strong>ì˜ˆë¬¸:</strong> {{ expressions[current_index].example }}
                        </div>
                        <button class="btn btn-primary w-100 mb-3" onclick="playAudio()">
                            <i class="fas fa-volume-up me-2"></i>ì˜ˆë¬¸ ì¬ìƒ
                        </button>
                        <audio id="audioPlayer" style="display: none;">
                            <source src="data:audio/wav;base64,UklGRiYAAABXQVZFZm10IBAAAAABAAEAQB8AAAB9AAACABAAZGF0YQIAAAAAAA==" type="audio/wav">
                        </audio>
                    </div>
                </div>

                <div class="row mb-4">
                    <div class="col-md-12">
                        <h6 class="text-muted mb-3">2ï¸âƒ£ ë”°ë¼ ë§í•˜ê¸°</h6>
                        <form method="POST" action="{{ url_for('check_daily_expression') }}" class="mb-3">
                            <input type="hidden" name="index" value="{{ current_index }}">
                            <div class="input-group">
                                <input type="text" name="user_input" class="form-control" 
                                       placeholder="í‘œí˜„ì„ ì…ë ¥í•˜ê³  ì—”í„°ë¥¼ ëˆ„ë¥´ì„¸ìš”"
                                       required>
                                <button class="btn btn-success" type="submit">
                                    <i class="fas fa-check me-2"></i>ì œì¶œ
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <h6 class="text-muted mb-3">3ï¸âƒ£ ì˜ë¯¸ ë° ì„¤ëª…</h6>
                        <div class="alert alert-light border">
                            <p><strong>ì˜ë¯¸:</strong> {{ expressions[current_index].meaning }}</p>
                            <p><strong>ìƒí™©:</strong> {{ expressions[current_index].situation }}</p>
                            <hr class="my-2">
                            <p class="mb-0"><strong>íŒ:</strong> {{ expressions[current_index].tip }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% elif completed %}
        <div class="card mb-4 bg-success bg-opacity-10 border-success">
            <div class="card-body text-center">
                <h4 class="text-success mb-3">
                    <i class="fas fa-check-circle me-2"></i>ì˜¤ëŠ˜ì˜ í‘œí˜„ í•™ìŠµ ì™„ë£Œ!
                </h4>
                <p class="text-muted mb-0">ë‚´ì¼ ìƒˆë¡œìš´ í‘œí˜„ë“¤ì„ ë°°ì›Œë³´ì„¸ìš”! ğŸŒŸ</p>
            </div>
        </div>
        {% endif %}

        <!-- ì™„ë£Œëœ í‘œí˜„ë“¤ -->
        {% if progress > 0 %}
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">í•™ìŠµí•œ í‘œí˜„ ({{ progress }}/5)</h5>
            </div>
            <div class="card-body">
                {% for i in range(progress) %}
                <div class="d-flex align-items-center mb-2 p-2 bg-light rounded">
                    <i class="fas fa-check-circle text-success me-2" style="font-size: 1.2rem;"></i>
                    <div>
                        <strong>{{ expressions[i].expression }}</strong><br>
                        <small class="text-muted">{{ expressions[i].meaning }}</small>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
</div>

<script>
function playAudio() {
    // ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” TTS APIë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ ë¯¸ë¦¬ ë…¹ìŒëœ ìŒì„± íŒŒì¼ì„ ì‚¬ìš©í•©ë‹ˆë‹¤
    const text = document.querySelector('.alert-info strong').nextSibling.textContent;
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'en-US';
    window.speechSynthesis.speak(utterance);
}
</script>
{% endblock %}
