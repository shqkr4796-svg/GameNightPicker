{% extends "base.html" %}

{% block title %}단어 퀴즈 - 라이프 시뮬레이션{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8">
        <!-- 퀴즈 섹션 -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i data-feather="book-open" class="me-2"></i>단어 퀴즈
                </h5>
            </div>
            <div class="card-body">
                {% set quiz_word = word_bank|random %}
                {% set question_type = ['뜻맞히기', '단어맞히기']|random %}
                
                <div class="text-center mb-4">
                    {% if question_type == '뜻맞히기' %}
                        <h4 class="text-primary">단어 뜻 맞히기</h4>
                        <div class="bg-light p-4 rounded mb-4">
                            <h2>{{ quiz_word['뜻'] }}</h2>
                        </div>
                        <p>위 뜻에 해당하는 영어 단어를 입력하세요.</p>
                    {% else %}
                        <h4 class="text-primary">단어를 보고 뜻 맞히기</h4>
                        <div class="bg-light p-4 rounded mb-4">
                            <h2>{{ quiz_word['단어'] }}</h2>
                        </div>
                        <p>위 단어의 뜻을 한글로 입력하세요.</p>
                    {% endif %}
                </div>

                <form method="POST" action="{{ url_for('take_quiz') }}">
                    <input type="hidden" name="question_type" value="{{ question_type }}">
                    <input type="hidden" name="correct_answer" 
                           value="{{ quiz_word['단어'] if question_type == '뜻맞히기' else quiz_word['뜻'] }}">
                    
                    <div class="mb-3">
                        <input type="text" name="answer" class="form-control form-control-lg text-center" 
                               placeholder="답을 입력하세요" required autofocus>
                    </div>
                    
                    <div class="text-center">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i data-feather="check" class="me-2"></i>정답 제출
                        </button>
                    </div>
                </form>
                
                <div class="mt-4 text-center">
                    <small class="text-muted">
                        퀴즈를 풀면 경험치를 획득하고 기력이 1 소모됩니다.
                    </small>
                </div>
            </div>
        </div>

        <!-- 단어장 관리 -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i data-feather="plus-circle" class="me-2"></i>단어 추가
                </h5>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('add_word') }}">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">영어 단어</label>
                                <input type="text" name="word" class="form-control" placeholder="예: apple" required>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">한글 뜻</label>
                                <input type="text" name="meaning" class="form-control" placeholder="예: 사과" required>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="mb-3">
                                <label class="form-label">카테고리</label>
                                <select name="category" class="form-select">
                                    {% for category in categories %}
                                    <option value="{{ category }}">{{ category }}</option>
                                    {% endfor %}
                                    <option value="새카테고리">새 카테고리</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="mb-3">
                                <label class="form-label">&nbsp;</label>
                                <button type="submit" class="btn btn-success w-100">
                                    <i data-feather="plus" class="me-1"></i>추가
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="col-lg-4">
        <!-- 퀴즈 통계 -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i data-feather="bar-chart-2" class="me-2"></i>퀴즈 통계
                </h5>
            </div>
            <div class="card-body text-center">
                <div class="row">
                    <div class="col-6">
                        <div class="border-end">
                            <h3 class="text-primary">{{ player['총_퀴즈'] }}</h3>
                            <small class="text-muted">총 문제 수</small>
                        </div>
                    </div>
                    <div class="col-6">
                        <h3 class="text-success">{{ player['정답_퀴즈'] }}</h3>
                        <small class="text-muted">정답 수</small>
                    </div>
                </div>
                <hr>
                <div class="text-center">
                    {% set accuracy = (player['정답_퀴즈'] / player['총_퀴즈'] * 100) if player['총_퀴즈'] > 0 else 0 %}
                    <h4 class="text-warning">{{ "%.1f"|format(accuracy) }}%</h4>
                    <small class="text-muted">정답률</small>
                </div>
            </div>
        </div>

        <!-- 단어장 현황 -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i data-feather="book" class="me-2"></i>단어장 현황
                </h5>
            </div>
            <div class="card-body">
                <div class="text-center mb-3">
                    <h3 class="text-info">{{ word_bank|length }}</h3>
                    <small class="text-muted">등록된 단어 수</small>
                </div>
                
                <h6 class="mb-2">카테고리별</h6>
                {% for category in categories %}
                    {% set category_count = word_bank|selectattr('카테고리', 'equalto', category)|list|length %}
                    <div class="d-flex justify-content-between mb-1">
                        <small>{{ category }}</small>
                        <small class="text-muted">{{ category_count }}개</small>
                    </div>
                {% endfor %}
            </div>
        </div>

        <!-- 학습 팁 -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i data-feather="lightbulb" class="me-2"></i>학습 팁
                </h5>
            </div>
            <div class="card-body">
                <ul class="list-unstyled mb-0">
                    <li class="mb-2">
                        <i data-feather="check-circle" class="text-success me-2" size="16"></i>
                        <small>꾸준히 퀴즈를 풀어 경험치를 모으세요.</small>
                    </li>
                    <li class="mb-2">
                        <i data-feather="check-circle" class="text-success me-2" size="16"></i>
                        <small>새로운 단어를 추가해서 학습량을 늘리세요.</small>
                    </li>
                    <li class="mb-2">
                        <i data-feather="check-circle" class="text-success me-2" size="16"></i>
                        <small>기력이 없으면 잠을 자서 회복하세요.</small>
                    </li>
                    <li>
                        <i data-feather="check-circle" class="text-success me-2" size="16"></i>
                        <small>카테고리별로 단어를 정리하면 효율적입니다.</small>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}
